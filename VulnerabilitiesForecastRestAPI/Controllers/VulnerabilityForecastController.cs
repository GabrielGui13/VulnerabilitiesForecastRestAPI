using Microsoft.AspNetCore.Mvc;
using Microsoft.Extensions.ML;
using Newtonsoft.Json;
using VulnerabilitiesForecastRestAPI.Models;

namespace VulnerabilitiesForecastRestAPI.Controllers {
	[ApiController]
	[Route("forecast")]
	public class VulnerabilityForecastController : ControllerBase {
		[HttpGet("predict")]
		async public Task<ModelOutput> Predict(PredictionEnginePool<ModelInput, ModelOutput> predictionEnginePool) {
			string mockReqJson = @"{ 'SentimentText':'I hate you' }";
			ModelInput? data = JsonConvert.DeserializeObject<ModelInput>(mockReqJson);

			ModelOutput response = await Task.FromResult(predictionEnginePool.Predict(modelName: "SentimentAnalysisModel", data));

			return response;
		}	

		[HttpPost("predict")]
		async public Task<ModelOutput> Predict(PredictionEnginePool<ModelInput, ModelOutput> predictionEnginePool, ModelInput input) {
			return await Task.FromResult(predictionEnginePool.Predict(modelName: "SentimentAnalysisModel", input));
		}

		[HttpPost("predictURL")]
		async public Task<ModelOutput> PredictURL(PredictionEnginePool<ModelInput, ModelOutput> predictionEnginePool, ModelInput input) {
			return await Task.FromResult(predictionEnginePool.Predict(modelName: "SentimentAnalysisModelURL", input));
		}
	}
}
